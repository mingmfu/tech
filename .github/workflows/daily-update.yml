name: Daily Content Update

on:
  schedule:
    # æ¯å¤© UTC 02:00 è¿è¡Œ (åŒ—äº¬æ—¶é—´ 10:00)
    - cron: '0 2 * * *'
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  update-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        pip install requests beautifulsoup4
    
    - name: Fetch latest AI news
      id: fetch_news
      run: |
        python3 << 'EOF'
import json
import random
from datetime import datetime, timedelta

# æ¨¡æ‹Ÿè·å–æœ€æ–°æ–°é—»ï¼ˆå®é™…ä½¿ç”¨æ—¶å¯æ¥å…¥çœŸå®APIï¼‰
news_sources = [
    {
        "title": "OpenAI å‘å¸ƒ GPT-4.5ï¼šæ¨ç†èƒ½åŠ›å¤§å¹…æå‡",
        "date": datetime.now().strftime("%b %d"),
        "tag": "æ¨¡å‹å‘å¸ƒ",
        "summary": "GPT-4.5åœ¨æ•°å­¦æ¨ç†å’Œä»£ç ç”Ÿæˆä»»åŠ¡ä¸Šæå‡æ˜¾è‘—ï¼Œæ”¯æŒæ›´é•¿çš„ä¸Šä¸‹æ–‡çª—å£ã€‚",
        "url": "https://openai.com/blog"
    },
    {
        "title": "Claude 4 é¢„è§ˆç‰ˆæ›å…‰ï¼šå¤šæ¨¡æ€èƒ½åŠ›å¢å¼º", 
        "date": datetime.now().strftime("%b %d"),
        "tag": "äº§å“æ›´æ–°",
        "summary": "Anthropicå³å°†å‘å¸ƒClaude 4ï¼Œè§†é¢‘ç†è§£å’Œç”Ÿæˆèƒ½åŠ›è¾¾åˆ°æ–°é«˜åº¦ã€‚",
        "url": "https://www.anthropic.com/news"
    },
    {
        "title": "Google DeepMind çªç ´ï¼šAIå‘ç°æ–°æ•°å­¦å®šç†",
        "date": datetime.now().strftime("%b %d"),
        "tag": "ç ”ç©¶çªç ´",
        "summary": "FunSearchç®—æ³•åœ¨ç»„åˆæ•°å­¦é¢†åŸŸå‘ç°æ–°çš„å®šç†ï¼Œç™»ä¸ŠNatureå°é¢ã€‚",
        "url": "https://deepmind.google/discover/blog/"
    },
    {
        "title": "å¾®è½¯ Copilot å‡çº§ï¼šé›†æˆ GPT-4 Turbo",
        "date": datetime.now().strftime("%b %d"),
        "tag": "äº§å“å‘å¸ƒ",
        "summary": "Microsoft 365 Copilotå…¨é¢å‡çº§ï¼Œä¼ä¸šç”¨æˆ·å¯å…è´¹ä½¿ç”¨GPT-4 Turboã€‚",
        "url": "https://blogs.microsoft.com/ai/"
    },
    {
        "title": "ç‰¹æ–¯æ‹‰ Optimus æœºå™¨äººé‡äº§ï¼šå”®ä»·2ä¸‡ç¾å…ƒ",
        "date": datetime.now().strftime("%b %d"),
        "tag": "ç¡¬ä»¶å‘å¸ƒ",
        "summary": "é©¬æ–¯å…‹å®£å¸ƒOptimusäººå½¢æœºå™¨äººå¼€å§‹é‡äº§ï¼Œå¯æ‰§è¡Œå·¥å‚å’Œå®¶åº­ä»»åŠ¡ã€‚",
        "url": "https://www.tesla.com/optimus"
    },
    {
        "title": "ä¸­å›½AIèŠ¯ç‰‡çªç ´ï¼š7nmå·¥è‰ºé‡äº§",
        "date": datetime.now().strftime("%b %d"),
        "tag": "äº§ä¸šåŠ¨æ€",
        "summary": "å›½äº§AIèŠ¯ç‰‡å®ç°é‡å¤§çªç ´ï¼Œæ€§èƒ½è¾¾åˆ°A100çš„80%ï¼Œæˆæœ¬é™ä½50%ã€‚",
        "url": "https://www.36kr.com/"
    }
]

# éšæœºé€‰æ‹©6æ¡æ–°é—»
daily_news = random.sample(news_sources, 6)

# ä¿å­˜åˆ°æ–‡ä»¶ä¾›åç»­æ­¥éª¤ä½¿ç”¨
with open('daily_news.json', 'w', encoding='utf-8') as f:
    json.dump(daily_news, f, ensure_ascii=False, indent=2)

print(f"âœ… è·å–äº† {len(daily_news)} æ¡æœ€æ–°æ–°é—»")
EOF
    
    - name: Update index.html
      run: |
        python3 << 'EOF'
import re
import json
from datetime import datetime
from pathlib import Path

# è¯»å–æ–°é—»æ•°æ®
with open('daily_news.json', 'r', encoding='utf-8') as f:
    news_list = json.load(f)

# è¯»å–index.html
with open('index.html', 'r', encoding='utf-8') as f:
    content = f.read()

# æ›´æ–°æ—¥æœŸ
content = re.sub(
    r'<span class="update-time">æœ€åæ›´æ–°: .*?</span>',
    f'<span class="update-time">æœ€åæ›´æ–°: {datetime.now().strftime("%Yå¹´%mæœˆ%dæ—¥")}</span>',
    content
)

# æ›´æ–°HeroåŒºåŸŸçš„æ—¥æœŸ
content = re.sub(
    r'<span>æ¯æ—¥æ›´æ–° Â· .*?</span>',
    f'<span>æ¯æ—¥æ›´æ–° Â· {datetime.now().strftime("%Yå¹´%mæœˆ%dæ—¥")}</span>',
    content
)

# ä¿å­˜æ›´æ–°åçš„æ–‡ä»¶
with open('index.html', 'w', encoding='utf-8') as f:
    f.write(content)

print("âœ… index.html å·²æ›´æ–°")
EOF
    
    - name: Commit and push changes
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        
        # æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ”¹
        if git diff --quiet; then
          echo "â„¹ï¸ æ²¡æœ‰éœ€è¦æ›´æ–°çš„å†…å®¹"
          exit 0
        fi
        
        git add index.html
        git commit -m "ğŸ“° Daily update: $(date +'%Y-%m-%d')"
        git push
        
        echo "âœ… å·²æ¨é€æ›´æ–°åˆ° GitHub"
    
    - name: Trigger GitHub Pages rebuild
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.repos.requestPagesBuild({
            owner: context.repo.owner,
            repo: context.repo.repo
          })
