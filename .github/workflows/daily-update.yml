name: Daily Content Update (Production)

on:
  schedule:
    - cron: '0 2 * * *'  # æ¯å¤©åŒ—äº¬æ—¶é—´10:00 (UTC 2:00)
  workflow_dispatch:

jobs:
  update-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: pip install requests
      
      - name: Generate AI Hot News
        run: |
          echo "ğŸ“ ç”ŸæˆAIçƒ­ç‚¹æ–°é—»..."
          python3 generate_20_news.py
      
      - name: Update Frontier Tech (OS, PL)
        run: |
          echo "ğŸ–¥ï¸ æ›´æ–°å‰æ²¿æŠ€æœ¯æ ç›®..."
          python3 update_2026_frontier.py
      
      - name: Update Website HTML
        run: |
          echo "ğŸŒ æ›´æ–°ç½‘ç«™HTML..."
          python3 scripts/update_website.py
      
      - name: Commit and push changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add -A
          if git diff --cached --quiet; then
            echo "â„¹ï¸ æ²¡æœ‰æ–°çš„å˜æ›´éœ€è¦æäº¤"
          else
            git commit -m "ğŸ“° æ¯æ—¥è‡ªåŠ¨æ›´æ–°: $(date +'%Y-%m-%d %H:%M')

- AIçƒ­ç‚¹: 20æ¡æœ€æ–°æ–°é—»
- æ“ä½œç³»ç»Ÿ: 6æ¡æœ€æ–°åŠ¨æ€
- ç¼–ç¨‹è¯­è¨€: 6æ¡æœ€æ–°åŠ¨æ€
- æ‰€æœ‰å†…å®¹å·²æ›´æ–°"
            git push
            echo "âœ… å·²æ¨é€æ›´æ–°åˆ°GitHub"
          fi
      
      - name: Trigger Pages rebuild
        if: success()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.repos.requestPagesBuild({
              owner: context.repo.owner,
              repo: context.repo.repo
            })
      
      - name: Notify success
        if: success()
        run: |
          echo "âœ… æ¯æ—¥æ›´æ–°å®Œæˆ!"
          echo "ğŸ“… æ—¥æœŸ: $(date +'%Y-%m-%d')"
          echo "ğŸŒ ç½‘ç«™: https://mingmfu.github.io/tech/"
